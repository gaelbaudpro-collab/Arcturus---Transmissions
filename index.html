<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcturus - Logiciel de Transmissions √âducatives</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script type="module">
        const STORAGE_KEY = 'arcturus_transmissions_shared_v2';
        
        let state = {
            activeTab: 'nouvelle',
            formData: {
                type: 'observation',
                usager: '',
                date: new Date().toISOString().split('T')[0],
                heure: new Date().toTimeString().slice(0,5),
                itemConcerne: '',
                redactionLibre: '',
                lieuPrecis: '',
                auteurPresume: '',
                victimePresumee: '',
                temoins: '',
                contexte: '',
                descriptionFaits: '',
                actionsImmediates: '',
                partagerAvec: []
            },
            transmissions: [],
            showSuccess: false,
            searchTerm: '',
            filterType: 'tous',
            currentUser: '√âtudiant ' + Math.floor(Math.random() * 100)
        };

        const usagers = ['Jean D.', 'Marie L.', 'Pierre M.', 'Sophie R.', 'Lucas B.', 'Emma T.', 'Thomas V.'];
        
        const itemsConcernes = [
            'Comportement', 'Autonomie', 'Socialisation', 'Activit√©s', 'Hygi√®ne',
            'Alimentation', 'Sommeil', 'Communication', 'Sant√©', 'Scolarit√©/Formation',
            'Famille', 'Projet personnalis√©'
        ];

        const destinataires = [
            'Direction', 'Chef de service', 'Coordinateur', '√âquipe √©ducative',
            'Ma√Ætresses de maison', 'Surveillants de nuit', '√âquipe m√©dicale'
        ];

        // Storage functions
        function saveToStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state.transmissions));
        }

        function loadFromStorage() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                state.transmissions = JSON.parse(stored);
            }
        }

        function render() {
            const app = document.getElementById('app');
            app.innerHTML = `
                <!-- Header -->
                <div class="bg-gradient-to-r from-indigo-900 to-purple-900 text-white p-4 shadow-lg">
                    <div class="max-w-7xl mx-auto flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="bg-white bg-opacity-20 p-2 rounded-lg">
                                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                            <div>
                                <h1 class="text-3xl font-bold">Arcturus</h1>
                                <p class="text-sm text-indigo-200">Logiciel de Transmissions √âducatives Partag√©es</p>
                            </div>
                        </div>
                        <div class="text-right text-sm bg-white bg-opacity-10 px-4 py-2 rounded-lg">
                            <p class="font-semibold">${state.currentUser}</p>
                            <p class="text-indigo-200">Mode Formation Collaborative</p>
                        </div>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="bg-white border-b border-gray-200 shadow-sm">
                    <div class="max-w-7xl mx-auto px-4">
                        <div class="flex gap-1">
                            <button onclick="changeTab('nouvelle')" class="px-6 py-3 font-medium transition-colors ${state.activeTab === 'nouvelle' ? 'bg-indigo-600 text-white' : 'text-gray-600 hover:bg-gray-50'}">
                                ‚ûï Nouvelle transmission
                            </button>
                            <button onclick="changeTab('historique')" class="px-6 py-3 font-medium transition-colors ${state.activeTab === 'historique' ? 'bg-indigo-600 text-white' : 'text-gray-600 hover:bg-gray-50'}">
                                üìã Historique partag√© (${state.transmissions.length})
                            </button>
                            <button onclick="changeTab('aide')" class="px-6 py-3 font-medium transition-colors ${state.activeTab === 'aide' ? 'bg-indigo-600 text-white' : 'text-gray-600 hover:bg-gray-50'}">
                                ‚ÑπÔ∏è Aide & Recommandations
                            </button>
                        </div>
                    </div>
                </div>

                ${state.showSuccess ? `
                <div class="fixed top-20 right-4 bg-green-600 text-white px-6 py-4 rounded-lg shadow-lg flex items-center gap-3 z-50">
                    <span class="text-2xl">‚úì</span>
                    <div>
                        <p class="font-semibold">Transmission enregistr√©e et partag√©e</p>
                        <p class="text-sm">Visible par tous les √©tudiants</p>
                    </div>
                </div>
                ` : ''}

                <!-- Content -->
                <div class="max-w-7xl mx-auto p-6">
                    ${state.activeTab === 'nouvelle' ? renderNouvelleTransmission() : ''}
                    ${state.activeTab === 'historique' ? renderHistorique() : ''}
                    ${state.activeTab === 'aide' ? renderAide() : ''}
                </div>
            `;
        }

        function renderNouvelleTransmission() {
            return `
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Nouvelle transmission</h2>
                    
                    <!-- Type -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Type de transmission *</label>
                        <div class="flex gap-4">
                            <button onclick="setType('observation')" class="flex-1 p-4 rounded-lg border-2 transition-all ${state.formData.type === 'observation' ? 'border-indigo-600 bg-indigo-50' : 'border-gray-300'}">
                                <span class="text-2xl">üëÅÔ∏è</span>
                                <p class="font-semibold">Observation</p>
                                <p class="text-xs text-gray-600">Faits objectifs du quotidien</p>
                            </button>
                            <button onclick="setType('evenement')" class="flex-1 p-4 rounded-lg border-2 transition-all ${state.formData.type === 'evenement' ? 'border-orange-600 bg-orange-50' : 'border-gray-300'}">
                                <span class="text-2xl">‚ö†Ô∏è</span>
                                <p class="font-semibold">√âv√©nement ind√©sirable</p>
                                <p class="text-xs text-gray-600">Incident, accident, situation critique</p>
                            </button>
                        </div>
                    </div>

                    <!-- Champs communs -->
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">üë§ Personne concern√©e *</label>
                            <select id="usager" class="w-full p-3 border border-gray-300 rounded-lg">
                                <option value="">S√©lectionner...</option>
                                ${usagers.map(u => `<option value="${u}" ${state.formData.usager === u ? 'selected' : ''}>${u}</option>`).join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">üìÖ Date *</label>
                            <input type="date" id="date" value="${state.formData.date}" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                    </div>

                    ${state.formData.type === 'observation' ? `
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Item concern√© *</label>
                            <select id="itemConcerne" class="w-full p-3 border border-gray-300 rounded-lg">
                                <option value="">S√©lectionner...</option>
                                ${itemsConcernes.map(i => `<option value="${i}" ${state.formData.itemConcerne === i ? 'selected' : ''}>${i}</option>`).join('')}
                            </select>
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">R√©daction libre *</label>
                            <textarea id="redactionLibre" rows="8" placeholder="D√©crivez de mani√®re objective et factuelle vos observations..." class="w-full p-3 border border-gray-300 rounded-lg">${state.formData.redactionLibre}</textarea>
                            <p class="text-xs text-gray-500 mt-1">Soyez factuel et objectif. √âvitez les jugements de valeur.</p>
                        </div>
                    ` : `
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">üïê Heure exacte *</label>
                                <input type="time" id="heure" value="${state.formData.heure}" class="w-full p-3 border border-gray-300 rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">üìç Lieu pr√©cis *</label>
                                <input type="text" id="lieuPrecis" value="${state.formData.lieuPrecis}" placeholder="Ex: Salle √† manger..." class="w-full p-3 border border-gray-300 rounded-lg">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Auteur pr√©sum√©</label>
                                <input type="text" id="auteurPresume" value="${state.formData.auteurPresume}" class="w-full p-3 border border-gray-300 rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Victime pr√©sum√©e</label>
                                <input type="text" id="victimePresumee" value="${state.formData.victimePresumee}" class="w-full p-3 border border-gray-300 rounded-lg">
                            </div>
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">üë• T√©moins</label>
                            <input type="text" id="temoins" value="${state.formData.temoins}" class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Contexte</label>
                            <textarea id="contexte" rows="3" class="w-full p-3 border border-gray-300 rounded-lg">${state.formData.contexte}</textarea>
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Description chronologique des faits *</label>
                            <textarea id="descriptionFaits" rows="6" class="w-full p-3 border border-gray-300 rounded-lg">${state.formData.descriptionFaits}</textarea>
                            <p class="text-xs text-red-600 mt-1">‚ö†Ô∏è Soyez tr√®s pr√©cis et factuel. Cette description a une valeur juridique.</p>
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Actions imm√©diates</label>
                            <textarea id="actionsImmediates" rows="4" class="w-full p-3 border border-gray-300 rounded-lg">${state.formData.actionsImmediates}</textarea>
                        </div>
                    `}

                    <!-- Partager avec -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">üîó Partager avec</label>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            ${destinataires.map(d => `
                                <label class="flex items-center gap-2 p-3 rounded-lg border-2 cursor-pointer ${state.formData.partagerAvec.includes(d) ? 'border-indigo-600 bg-indigo-50' : 'border-gray-300'}">
                                    <input type="checkbox" ${state.formData.partagerAvec.includes(d) ? 'checked' : ''} onchange="togglePartager('${d}')" class="w-4 h-4">
                                    <span class="text-sm font-medium">${d}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>

                    <div class="flex gap-4 pt-4 border-t">
                        <button onclick="submitForm()" class="flex-1 bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700">
                            üíæ Enregistrer et partager
                        </button>
                        <button onclick="resetForm()" class="px-6 py-3 border-2 border-gray-300 rounded-lg font-semibold hover:bg-gray-50">
                            R√©initialiser
                        </button>
                    </div>
                </div>
            `;
        }

        function renderHistorique() {
            const filtered = state.transmissions.filter(t => {
                const matchSearch = t.usager.toLowerCase().includes(state.searchTerm.toLowerCase()) ||
                                   (t.redactionLibre && t.redactionLibre.toLowerCase().includes(state.searchTerm.toLowerCase())) ||
                                   (t.descriptionFaits && t.descriptionFaits.toLowerCase().includes(state.searchTerm.toLowerCase()));
                const matchFilter = state.filterType === 'tous' || t.type === state.filterType;
                return matchSearch && matchFilter;
            });

            return `
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Historique partag√© des transmissions</h2>
                        <div class="bg-indigo-100 text-indigo-800 px-4 py-2 rounded-lg font-semibold">
                            ${state.transmissions.length} transmission(s)
                        </div>
                    </div>
                    
                    <div class="flex gap-4 mb-6">
                        <input type="text" placeholder="Rechercher..." id="searchInput" value="${state.searchTerm}" 
                            onkeyup="updateSearch(this.value)" class="flex-1 p-3 border rounded-lg">
                        <select id="filterSelect" onchange="updateFilter(this.value)" class="p-3 border rounded-lg">
                            <option value="tous" ${state.filterType === 'tous' ? 'selected' : ''}>Tous</option>
                            <option value="observation" ${state.filterType === 'observation' ? 'selected' : ''}>Observations</option>
                            <option value="evenement" ${state.filterType === 'evenement' ? 'selected' : ''}>√âv√©nements</option>
                        </select>
                    </div>

                    <div class="space-y-4">
                        ${filtered.length === 0 ? `
                            <div class="text-center py-12 text-gray-500">
                                <p class="text-lg font-medium">Aucune transmission pour le moment</p>
                            </div>
                        ` : filtered.map(t => `
                            <div class="border-2 border-gray-200 rounded-lg p-5 hover:shadow-lg transition-all">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="flex items-center gap-3">
                                        <div class="p-3 rounded-lg ${t.type === 'observation' ? 'bg-indigo-100' : 'bg-orange-100'}">
                                            ${t.type === 'observation' ? 'üëÅÔ∏è' : '‚ö†Ô∏è'}
                                        </div>
                                        <div>
                                            <h3 class="font-bold text-lg">${t.usager}</h3>
                                            <p class="text-sm text-gray-600">
                                                ${t.date} ${t.type === 'evenement' && t.heure ? ' √† ' + t.heure : ''}
                                                ${t.type === 'observation' && t.itemConcerne ? ' ‚Ä¢ ' + t.itemConcerne : ''}
                                                ${t.type === 'evenement' && t.lieuPrecis ? ' ‚Ä¢ ' + t.lieuPrecis : ''}
                                            </p>
                                        </div>
                                    </div>
                                    <span class="px-3 py-1 rounded-full text-xs font-semibold ${t.type === 'observation' ? 'bg-indigo-100 text-indigo-800' : 'bg-orange-100 text-orange-800'}">
                                        ${t.type === 'observation' ? 'Observation' : '√âv√©nement'}
                                    </span>
                                </div>

                                ${t.type === 'observation' ? `
                                    <div class="bg-gray-50 rounded-lg p-4 mb-3">
                                        <p class="text-gray-800 whitespace-pre-line">${t.redactionLibre}</p>
                                    </div>
                                ` : `
                                    <div class="space-y-3">
                                        ${t.auteurPresume ? `<p class="text-sm"><strong>Auteur pr√©sum√© :</strong> ${t.auteurPresume}</p>` : ''}
                                        ${t.victimePresumee ? `<p class="text-sm"><strong>Victime pr√©sum√©e :</strong> ${t.victimePresumee}</p>` : ''}
                                        ${t.temoins ? `<p class="text-sm"><strong>T√©moins :</strong> ${t.temoins}</p>` : ''}
                                        ${t.contexte ? `
                                            <div class="bg-gray-50 rounded p-3">
                                                <p class="text-xs font-semibold text-gray-600 mb-1">CONTEXTE</p>
                                                <p class="text-sm">${t.contexte}</p>
                                            </div>
                                        ` : ''}
                                        <div class="bg-orange-50 rounded p-3">
                                            <p class="text-xs font-semibold text-orange-600 mb-1">DESCRIPTION DES FAITS</p>
                                            <p class="text-sm whitespace-pre-line">${t.descriptionFaits}</p>
                                        </div>
                                        ${t.actionsImmediates ? `
                                            <div class="bg-green-50 rounded p-3">
                                                <p class="text-xs font-semibold text-green-600 mb-1">ACTIONS IMM√âDIATES</p>
                                                <p class="text-sm whitespace-pre-line">${t.actionsImmediates}</p>
                                            </div>
                                        ` : ''}
                                    </div>
                                `}

                                <div class="flex items-center justify-between mt-4 pt-4 border-t">
                                    <p class="text-sm text-gray-600"><strong>Auteur :</strong> ${t.auteur}</p>
                                    ${t.partagerAvec && t.partagerAvec.length > 0 ? `
                                        <div class="flex flex-wrap gap-1">
                                            ${t.partagerAvec.map(d => `<span class="text-xs bg-gray-200 px-2 py-1 rounded">${d}</span>`).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderAide() {
            return `
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Aide & Recommandations professionnelles</h2>
                    
                    <div class="space-y-6">
                        <div class="bg-indigo-50 border-l-4 border-indigo-600 p-6 rounded-r-lg">
                            <h3 class="font-bold text-lg mb-3">üëÅÔ∏è Observation quotidienne</h3>
                            <p class="mb-3">L'observation est un outil essentiel du travail √©ducatif.</p>
                            <p class="text-sm"><strong>‚úì √Ä faire :</strong></p>
                            <ul class="list-disc ml-6 text-sm space-y-1 mb-3">
                                <li>D√©crire des faits observables</li>
                                <li>Utiliser un langage neutre</li>
                                <li>Situer dans le temps et l'espace</li>
                            </ul>
                            <p class="text-sm"><strong>‚úó √Ä √©viter :</strong></p>
                            <ul class="list-disc ml-6 text-sm space-y-1">
                                <li>Les jugements de valeur</li>
                                <li>Les interpr√©tations</li>
                                <li>Les g√©n√©ralisations</li>
                            </ul>
                        </div>

                        <div class="bg-orange-50 border-l-4 border-orange-600 p-6 rounded-r-lg">
                            <h3 class="font-bold text-lg mb-3">‚ö†Ô∏è √âv√©nement ind√©sirable</h3>
                            <p class="mb-3">N√©cessite une tra√ßabilit√© renforc√©e.</p>
                            <p class="text-sm"><strong>√âl√©ments obligatoires :</strong></p>
                            <ul class="list-disc ml-6 text-sm space-y-1">
                                <li>Heure exacte et lieu pr√©cis</li>
                                <li>Identification des personnes</li>
                                <li>Description chronologique</li>
                                <li>Actions imm√©diates</li>
                            </ul>
                        </div>

                        <div class="bg-green-50 border-l-4 border-green-600 p-6 rounded-r-lg">
                            <h3 class="font-bold text-lg mb-3">Exemples</h3>
                            <div class="space-y-3 text-sm">
                                <div>
                                    <p class="text-red-700">‚ùå Jean √©tait agressif</p>
                                    <p class="text-green-700">‚úÖ √Ä 15h30, Jean a frapp√© du poing sur la table</p>
                                </div>
                                <div>
                                    <p class="text-red-700">‚ùå Marie ne fait jamais d'efforts</p>
                                    <p class="text-green-700">‚úÖ Ce matin, Marie n'a pas particip√© √† l'activit√©</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Event handlers
        window.changeTab = (tab) => {
            state.activeTab = tab;
            render();
        };

        window.setType = (type) => {
            state.formData.type = type;
            render();
        };

        window.togglePartager = (dest) => {
            if (state.formData.partagerAvec.includes(dest)) {
                state.formData.partagerAvec = state.formData.partagerAvec.filter(d => d !== dest);
            } else {
                state.formData.partagerAvec.push(dest);
            }
        };

        window.submitForm = () => {
            const usager = document.getElementById('usager').value;
            const date = document.getElementById('date').value;

            if (state.formData.type === 'observation') {
                const itemConcerne = document.getElementById('itemConcerne').value;
                const redactionLibre = document.getElementById('redactionLibre').value;
                
                if (!usager || !itemConcerne || !redactionLibre) {
                    alert('Veuillez remplir tous les champs obligatoires');
                    return;
                }
                
                state.formData.usager = usager;
                state.formData.date = date;
                state.formData.itemConcerne = itemConcerne;
                state.formData.redactionLibre = redactionLibre;
            } else {
                const heure = document.getElementById('heure').value;
                const lieuPrecis = document.getElementById('lieuPrecis').value;
                const descriptionFaits = document.getElementById('descriptionFaits').value;
                
                if (!usager || !heure || !lieuPrecis || !descriptionFaits) {
                    alert('Veuillez remplir tous les champs obligatoires');
                    return;
                }
                
                state.formData.usager = usager;
                state.formData.date = date;
                state.formData.heure = heure;
                state.formData.lieuPrecis = lieuPrecis;
                state.formData.auteurPresume = document.getElementById('auteurPresume').value;
                state.formData.victimePresumee = document.getElementById('victimePresumee').value;
                state.formData.temoins = document.getElementById('temoins').value;
                state.formData.contexte = document.getElementById('contexte').value;
                state.formData.descriptionFaits = descriptionFaits;
                state.formData.actionsImmediates = document.getElementById('actionsImmediates').value;
            }

            const newTransmission = {
                id: Date.now(),
                ...state.formData,
                auteur: state.currentUser,
                dateCreation: new Date().toISOString()
            };

            state.transmissions.unshift(newTransmission);
            saveToStorage();

            state.formData = {
                type: 'observation',
                usager: '',
                date: new Date().toISOString().split('T')[0],
                heure: new Date().toTimeString().slice(0,5),
                itemConcerne: '',
                redactionLibre: '',
                lieuPrecis: '',
                auteurPresume: '',
                victimePresumee: '',
                temoins: '',
                contexte: '',
                descriptionFaits: '',
                actionsImmediates: '',
                partagerAvec: []
            };

            state.showSuccess = true;
            render();
            setTimeout(() => {
                state.showSuccess = false;
                state.activeTab = 'historique';
                render();
            }, 2000);
        };

        window.resetForm = () => {
            state.formData = {
                type: 'observation',
                usager: '',
                date: new Date().toISOString().split('T')[0],
                heure: new Date().toTimeString().slice(0,5),
                itemConcerne: '',
                redactionLibre: '',
                lieuPrecis: '',
                auteurPresume: '',
                victimePresumee: '',
                temoins: '',
                contexte: '',
                descriptionFaits: '',
                actionsImmediates: '',
                partagerAvec: []
            };
            render();
        };

        window.updateSearch = (value) => {
            state.searchTerm = value;
            render();
        };

        window.updateFilter = (value) => {
            state.filterType = value;
            render();
        };

        // Initialize
        loadFromStorage();
        render();
    </script>
</body>
</html>
